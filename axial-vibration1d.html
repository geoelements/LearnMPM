
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Axial vibration of a 1D bar &#8212; Learn MPM</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Coding 1D MPM" href="mpm-code.html" />
    <link rel="prev" title="1D vibration of a single material point" href="point-axial-vibration1d.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Learn MPM</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to learn MPM with Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="point-axial-vibration1d.html">
   1D vibration of a single material point
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Axial vibration of a 1D bar
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="mpm-code.html">
   Coding 1D MPM
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="learnmpm-axial-vibration1d.html">
     Axial vibration of 1D bar using LearnMPM
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/geoelements/learn-mpm/main?urlpath=lab/tree/docs/axial-vibration1d.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/geoelements/learn-mpm/blob/main/docs/axial-vibration1d.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/geoelements/learn-mpm"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/geoelements/learn-mpm/issues/new?title=Issue%20on%20page%20%2Faxial-vibration1d.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/axial-vibration1d.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mpm-axial-vibration-of-a-1d-bar">
   MPM axial vibration of a 1D bar
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-results">
     Plot results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extending-it-to-support-multiple-material-points">
   Extending it to support multiple material points
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-material-points-in-a-cell">
     Generating material points in a cell
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-multiple-material-points-per-cell">
     Generating multiple material points per cell
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iterate-over-particles">
     Iterate over particles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-material-points-per-cell">
     Multiple material points per cell
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Axial vibration of a 1D bar</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mpm-axial-vibration-of-a-1d-bar">
   MPM axial vibration of a 1D bar
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-results">
     Plot results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extending-it-to-support-multiple-material-points">
   Extending it to support multiple material points
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-material-points-in-a-cell">
     Generating material points in a cell
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-multiple-material-points-per-cell">
     Generating multiple material points per cell
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iterate-over-particles">
     Iterate over particles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-material-points-per-cell">
     Multiple material points per cell
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="axial-vibration-of-a-1d-bar">
<h1>Axial vibration of a 1D bar<a class="headerlink" href="#axial-vibration-of-a-1d-bar" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/geoelements/learn-mpm/blob/main/book/axial-vibration1d.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>Let’s study the axial vibration of a continuum bar with Young’s modulus E = 100 and the bar length L = 25.
Exact solutions for mode 1 are:</p>
<p><span class="math notranslate nohighlight">\(v(x, t) = v_0 \cos(\omega_1 t) \sin(\beta_1 x)\)</span></p>
<p><span class="math notranslate nohighlight">\(u(x, t) = \frac{v_0}{\omega_1} \sin(\omega_1 t) \sin(\beta_1 x)\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\omega_1 = \frac{\pi}{2 L}\sqrt{E/\rho}\)</span> and <span class="math notranslate nohighlight">\(\beta_1 = \frac{\pi}{2L}\)</span>. The initial velocity is <span class="math notranslate nohighlight">\(v(x, 0) = v_0 \sin(\beta_1 x)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np

def axial_vibration_bar1d(L, E, rho, duration, dt, v0, x):

    # Frequency of system mode 1
    w1 = np.pi / (2 * L) * np.sqrt(E/rho)
    b1 = np.pi / (2 * L)

    # position and velocity in time
    tt, vt, xt = [], [], []

    nsteps = int(duration/dt)
    t = 0
    for _ in range(nsteps):
        vt.append(v0 * np.cos(w1 * t) * np.sin(b1 * x))
        xt.append(v0 / w1 * np.sin(w1 * t) * np.sin(b1 * x))
        tt.append(t)

        t += dt
    
    return tt, vt, xt
</pre></div>
</div>
</div>
</div>
<p>Let’s now plot the analytical solution of a vibrating bar at the end of the bar <span class="math notranslate nohighlight">\(x = 1\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt

# Properties
E = 100
L = 25

# analytical solution at the end of the bar
ta, va, xa = axial_vibration_bar1d(L = L, E = E, rho = 1, duration = 100, dt = 0.01, v0 = 0.1, x = 12.5)

plt.plot(ta, va, &#39;r&#39;,linewidth=2,label=&#39;analytical&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;velocity (m/s)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_3_0.png" src="_images/axial-vibration1d_3_0.png" />
</div>
</div>
<section id="mpm-axial-vibration-of-a-1d-bar">
<h2>MPM axial vibration of a 1D bar<a class="headerlink" href="#mpm-axial-vibration-of-a-1d-bar" title="Permalink to this headline">#</a></h2>
<p>The grid consists of 13 two-noded line elements (14 grid nodes) and 13 material points placed at the center of the elements are used. We study the axial vibration of a continuum bar with Young’s modulus E = 100 and the bar length L = 25. The time increment is chosen as <span class="math notranslate nohighlight">\(\Delta t = 0.1 \Delta x / c\)</span> where <span class="math notranslate nohighlight">\(\Delta x\)</span> denotes the nodal spacing. The initial velocity is given by: <span class="math notranslate nohighlight">\(v (x, 0) = v_0 \sin (\beta_1 x)\)</span>, where <span class="math notranslate nohighlight">\(v_0 = 0.1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import matplotlib.pyplot as plt

# mass tolerance
tol = 1e-12

# Domain
L = 25

# Material properties
E = 100
rho = 1

# Computational grid

nelements = 13 # number of elements
dx = L / nelements # element length

# Create equally spaced nodes
x_n = np.linspace(0, L, nelements+1)
nnodes = len(x_n)

# Set-up a 2D array of elements with node ids
elements = np.zeros((nelements, 2), dtype = int)
for nid in range(nelements):
    elements[nid, :] = np.array([nid, nid+1])

# Loading conditions
v0 = 0.1             # initial velocity
c  = np.sqrt(E/rho)  # speed of sound
b1 = np.pi / (2 * L) # beta1
w1 = b1 * c          # omega1

# Create material points at the center of each element
nparticles = nelements  # number of particles
# Id of the particle in the central element
pmid = int(np.floor((nparticles/2)))

# Material point properties
x_p      = np.zeros(nparticles)       # positions
vol_p    = np.ones(nparticles) * dx   # volume
mass_p   = vol_p * rho                # mass
stress_p = np.zeros(nparticles)       # stress
vel_p    = np.zeros(nparticles)       # velocity
vol0_p   = vol_p                      # initial volume

for i in range(nelements):
    # Create particle at the center
    x_p[i] = 0.5 * (x_n[i] + x_n[i+1])
    # set initial velocities
    vel_p[i] = v0 * np.sin(b1 * x_p[i])

# Time steps and duration
duration = 100
dt_crit = dx / c
dt = 0.1 * dt_crit
t = 0
nsteps = int(duration / dt)

tt, vt, xt = [], [], []

for step in range(nsteps):
    # reset nodal values
    mass_n  = np.zeros(nnodes)  # mass
    mom_n   = np.zeros(nnodes)  # momentum
    fint_n = np.zeros(nnodes)  # internal force

    # iterate through each element
    for id in range(nelements):
        # get nodal ids
        nid1, nid2 = elements[id]
        
        # compute shape functions and derivatives
        N1 = 1 - abs(x_p[id] - x_n[nid1]) / dx
        N2 = 1 - abs(x_p[id] - x_n[nid2]) / dx
        dN1 = -1/dx
        dN2 = 1/dx

        # map particle mass and momentum to nodes
        mass_n[nid1] += N1 * mass_p[id]
        mass_n[nid2] += N2 * mass_p[id]
        mom_n[nid1]  += N1 * mass_p[id] * vel_p[id]
        mom_n[nid2]  += N2 * mass_p[id] * vel_p[id]

        # compute nodal internal force
        fint_n[nid1] -= vol_p[id] * stress_p[id] * dN1
        fint_n[nid2] -= vol_p[id] * stress_p[id] * dN2

    # apply boundary conditions
    mom_n[0]  = 0  # Nodal velocity v = 0 in m * v at node 0.
    fint_n[0] = 0  # Nodal force f = m * a, where a = 0 at node 0.

    # update nodal momentum
    for nid in range(nnodes):
        mom_n[nid] += fint_n[nid] * dt

    # update particle velocity position and stress
    # iterate through each element
    for id in range(nelements):
        # get nodal ids
        nid1, nid2 = elements[id]
        
        # compute shape functions and derivatives
        N1 = 1 - abs(x_p[id] - x_n[nid1]) / dx
        N2 = 1 - abs(x_p[id] - x_n[nid2]) / dx
        dN1 = -1/dx
        dN2 = 1/dx

        # compute particle velocity
        if (mass_n[nid1]) &gt; tol:
            vel_p[id] += dt * N1 * fint_n[nid1] / mass_n[nid1]
        if (mass_n[nid2]) &gt; tol:
            vel_p[id] += dt * N2 * fint_n[nid2] / mass_n[nid2]
        
        # update particle position based on nodal momentum
        x_p[id] += dt * (N1 * mom_n[nid1]/mass_n[nid1] + N2 * mom_n[nid2]/mass_n[nid2])

        # nodal velocity
        nv1 = mom_n[nid1]/mass_n[nid1]
        nv2 = mom_n[nid2]/mass_n[nid2]

        # Apply boundary condition
        # Rendundant, since momentum and forces are already set to zero
        # if (nid1 == 0): nv1 = 0

        # rate of strain increment
        grad_v = dN1 * nv1 + dN2 * nv2
        # particle dstrain
        dstrain = grad_v * dt
        # particle volume
        vol_p[id] *= (1 + dstrain)        
        # update stress using linear elastic model
        stress_p[id] += E * dstrain

    # update plot params
    tt.append(t)
    vt.append(vel_p[pmid])
    xt.append(x_p[pmid])

    t = t + dt
</pre></div>
</div>
</div>
</div>
<section id="plot-results">
<h3>Plot results<a class="headerlink" href="#plot-results" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><p>Velocity</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.plot(ta, va, &#39;r&#39;, linewidth=1,label=&#39;analytical&#39;)
plt.plot(tt, vt, &#39;ob&#39;, markersize=1, label=&#39;mpm&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;velocity (m/s)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_7_0.png" src="_images/axial-vibration1d_7_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.plot(ta, xa, &#39;r&#39;, linewidth=1,label=&#39;analytical&#39;)
plt.plot(tt, xt - xt[0], &#39;ob&#39;, markersize=1, label=&#39;mpm&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;displacement (m)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_8_0.png" src="_images/axial-vibration1d_8_0.png" />
</div>
</div>
</section>
</section>
<section id="extending-it-to-support-multiple-material-points">
<h2>Extending it to support multiple material points<a class="headerlink" href="#extending-it-to-support-multiple-material-points" title="Permalink to this headline">#</a></h2>
<p>The code we have written is specific for a two-noded element with a single material point at the center of the element. The first step is to implement multiple material points in an element. Let’s start with particle generation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Material point properties</span>
<span class="n">x_p</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nparticles</span><span class="p">)</span>       <span class="c1"># positions</span>
<span class="n">vol_p</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nparticles</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>   <span class="c1"># volume</span>
<span class="n">mass_p</span>   <span class="o">=</span> <span class="n">vol_p</span> <span class="o">*</span> <span class="n">rho</span>                <span class="c1"># mass</span>
<span class="n">stress_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nparticles</span><span class="p">)</span>       <span class="c1"># stress</span>
<span class="n">vel_p</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nparticles</span><span class="p">)</span>       <span class="c1"># velocity</span>
<span class="n">vol0_p</span>   <span class="o">=</span> <span class="n">vol_p</span>                      <span class="c1"># initial volume</span>

<span class="c1"># Generate material points in cell</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelements</span><span class="p">):</span>
    <span class="c1"># Create particle at the center</span>
    <span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_n</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># set initial velocities</span>
    <span class="n">vel_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b1</span> <span class="o">*</span> <span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p>We are placing the particles at the center of the element, so the volume and mass of a particle is the volume and mass of the element. Let’s create a new variable called <code class="docutils literal notranslate"><span class="pre">ppc</span></code> (particles per cell) to support multiple material points (particles) per cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Material point properties
# Unchanged definitions
x_p      = np.zeros(nparticles)            # positions
stress_p = np.zeros(nparticles)            # stress
vel_p    = np.zeros(nparticles)            # velocity

# New/updated variables
ppc      = 1                               # particles / cell
vol_p    = np.ones(nparticles) * dx / ppc  # volume

# these variables haven&#39;t changed, they are updated based on vol
mass_p   = vol_p * rho                     # mass
vol0_p   = vol_p                           # initial volume
</pre></div>
</div>
</div>
</div>
<section id="generating-material-points-in-a-cell">
<h3>Generating material points in a cell<a class="headerlink" href="#generating-material-points-in-a-cell" title="Permalink to this headline">#</a></h3>
<p>The current implementation generates a single material point per element.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>x_p      = np.zeros(nparticles)            # positions
# Generate material points in cell
for i in range(nelements):
    # Create particle at the center
    x_p[i] = 0.5 * (x_n[i] + x_n[i+1])
    # set initial velocities
    vel_p[i] = v0 * np.sin(b1 * x_p[i])
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>Let’s plot the current mesh with a single material point per cell and see how it looks</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Function to plot mesh
import matplotlib.pyplot as plt
def plot_mesh(elements, x_n, x_p, fontsize=13):
    # plt.cla()
    fig = plt.gcf()
    fig.set_size_inches(15, 5)
    eid = 0
    for element in elements:
        n1, n2 = element
        n1x, n2x = x_n[n1], x_n[n2]
        plt.plot([n1x,n2x],[0,0],&#39;--sk&#39;)
        dy = 0.005
        
        x=(n1x + n2x)/2
        plt.annotate(&quot;e%d&quot;%eid, xy=(x,-1.5*dy),fontsize=fontsize)
        plt.annotate(&quot;n%d&quot;%n1, xy=(n1x,dy),fontsize=fontsize)
        plt.annotate(&quot;n%d&quot;%n2, xy=(n2x,dy),fontsize=fontsize)
        eid = eid + 1

    pid = 0    
    for x in x_p:
        plt.plot(x,0,&#39;ob&#39;)
        plt.annotate(&quot;p%d&quot;%pid, xy=(x, dy),fontsize=fontsize)
        pid = pid + 1
 
    n1 = elements[0][0]
    x = x_n[n1]
    y = -0.04
    plt.annotate(&quot;n = node\np = material point\ne = element&quot;, xy=(x,y),fontsize=fontsize)
    plt.xlabel(r&quot;Node position, $x_I$&quot;)
    plt.title(&quot;Mesh and Material Points&quot;)
    plt.show()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plot_mesh(elements, x_n, x_p)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_15_0.png" src="_images/axial-vibration1d_15_0.png" />
</div>
</div>
</section>
<section id="generating-multiple-material-points-per-cell">
<h3>Generating multiple material points per cell<a class="headerlink" href="#generating-multiple-material-points-per-cell" title="Permalink to this headline">#</a></h3>
<p>Let’s define a function that takes the number of particles per cell as an argument and return an array of positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def generate_particles(ppc, elements, x_n):
    &quot;&quot;&quot;
    Generate particles in mesh

    Arguments:
    ppc: int
        number of particles per cell

    elements: List
        node ids of each element
    
    x_n: List
        nodal coordinates
    
    Returns:
    x_p: List
        particle coordinates
    el_pids: List
        List of particle ids for each cell
    &quot;&quot;&quot;
    # ppc = number of particles per cell
    # total number of particles
    nparticles = nelements * ppc
    # positions
    x_p  = np.zeros(nparticles)
    # particle id
    pid = 0
    eid = 0

    # Create a map of particle ids to each element
    mpoints = []
    # iterate through each element
    for element in elements:
        # get nodal ids
        n1, n2 = element
        # get nodal coordinates
        n1x, n2x = x_n[n1], x_n[n2]
        # element length
        dx = abs(n2x - n1x)
        # create an empty list of particles for each cell
        particles = []
        # generate particles uniformly across the element
        for _ in range(ppc):
            # first particle
            if(len(particles)==0):
                x_p[pid] = n1x + dx/(2 * ppc)
            # last particle
            elif(len(particles)==(ppc - 1)):
                x_p[pid] = n2x - dx/(2 * ppc)
            # mid particles
            else:
                x_p[pid] = n1x + dx/(2 * ppc) + len(particles) * (dx/ppc)
            
            # Append to particles
            particles.append(pid)
            # particle id
            pid += 1
        
        # Add pids to each element
        mpoints.append(particles)
        # element id    
        eid += 1 

    return x_p, mpoints
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>1 PPC</p>
</div></blockquote>
<p>Let us know generate a single material point per cell and plot to see if we get the same result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>x_p, _ = generate_particles(ppc=1, elements=elements, x_n=x_n)
plot_mesh(elements, x_n, x_p)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_19_0.png" src="_images/axial-vibration1d_19_0.png" />
</div>
</div>
<blockquote>
<div><p>2 PPC</p>
</div></blockquote>
<p>Let us know generate two material point per cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>x_p, _ = generate_particles(ppc=2, elements=elements, x_n=x_n)
plot_mesh(elements, x_n, x_p, fontsize=9)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_21_0.png" src="_images/axial-vibration1d_21_0.png" />
</div>
</div>
</section>
<section id="iterate-over-particles">
<h3>Iterate over particles<a class="headerlink" href="#iterate-over-particles" title="Permalink to this headline">#</a></h3>
<p>Now that we have the ability to generate multiple material points per cell, we should also change how we loop over particle to map particle properties to node. Instead of mapping a single material property to the node, we need to map all particles’ properties in the element to the node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># iterate through each element</span>
    <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelements</span><span class="p">):</span>
        <span class="c1"># get nodal ids</span>
        <span class="n">nid1</span><span class="p">,</span> <span class="n">nid2</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>

        <span class="c1"># compute shape functions and derivatives</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="n">dN1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">dx</span>
        <span class="n">dN2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dx</span>

        <span class="c1"># map particle mass and momentum to nodes</span>
        <span class="n">mass_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">N1</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="n">mass_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">N2</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="n">mom_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">]</span>  <span class="o">+=</span> <span class="n">N1</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="n">mom_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">]</span>  <span class="o">+=</span> <span class="n">N2</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>

        <span class="c1"># compute nodal internal force</span>
        <span class="n">fint_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">vol_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">*</span> <span class="n">stress_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">*</span> <span class="n">dN1</span>
        <span class="n">fint_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">vol_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">*</span> <span class="n">stress_p</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">*</span> <span class="n">dN2</span>
</pre></div>
</div>
<p>We need the associated particle ids for each element. We have the variable <code class="docutils literal notranslate"><span class="pre">mpoints</span></code> returned by <code class="docutils literal notranslate"><span class="pre">generate_particles()</span></code> function. The variable <code class="docutils literal notranslate"><span class="pre">mpoints</span></code> maps the particle ids to each element. Now we can iterate through all the particles in each element, instead of one particle per element.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate through each element</span>
<span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelements</span><span class="p">):</span>
    <span class="c1"># get nodal ids</span>
    <span class="n">nid1</span><span class="p">,</span> <span class="n">nid2</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>    
    <span class="c1"># get particle ids associated with the element </span>
    <span class="n">mpts</span> <span class="o">=</span> <span class="n">mpoints</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
    <span class="c1"># iterate through all particles in the element</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">mpts</span><span class="p">:</span>
        <span class="c1"># compute shape functions and derivatives</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="n">dN1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">dx</span>
        <span class="n">dN2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dx</span>

        <span class="c1"># map particle mass and momentum to nodes</span>
        <span class="n">mass_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">N1</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span>
        <span class="n">mass_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">N2</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span>
        <span class="n">mom_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">]</span>  <span class="o">+=</span> <span class="n">N1</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span>
        <span class="n">mom_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">]</span>  <span class="o">+=</span> <span class="n">N2</span> <span class="o">*</span> <span class="n">mass_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span>

        <span class="c1"># compute nodal internal force</span>
        <span class="n">fint_n</span><span class="p">[</span><span class="n">nid1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">vol_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">*</span> <span class="n">stress_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">*</span> <span class="n">dN1</span>
        <span class="n">fint_n</span><span class="p">[</span><span class="n">nid2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">vol_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">*</span> <span class="n">stress_p</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">*</span> <span class="n">dN2</span>
</pre></div>
</div>
<p>Similarly, we will modify the mapping from node to particles.</p>
</section>
<section id="multiple-material-points-per-cell">
<h3>Multiple material points per cell<a class="headerlink" href="#multiple-material-points-per-cell" title="Permalink to this headline">#</a></h3>
<p>Full implementation to support multiple material points per cell. The following example shows how to perform the axial vibration in a 1D bar with 2 particles per cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import matplotlib.pyplot as plt

# particles per cell
ppc      = 2                 

# mass tolerance
tol = 1e-12

# Domain
L = 25

# Material properties
E = 100
rho = 1

# Computational grid

nelements = 13 # number of elements
dx = L / nelements # element length

# Create equally spaced nodes
x_n = np.linspace(0, L, nelements+1)
nnodes = len(x_n)

# Set-up a 2D array of elements with node ids
elements = np.zeros((nelements, 2), dtype = int)
for nid in range(nelements):
    elements[nid, :] = np.array([nid, nid+1])

# Loading conditions
v0 = 0.1             # initial velocity
c  = np.sqrt(E/rho)  # speed of sound
b1 = np.pi / (2 * L) # beta1
w1 = b1 * c          # omega1

# Create material points 
nparticles = nelements * ppc  # number of particles
# Id of the particle in the central element
pmid = int(np.floor((nparticles/2)))

# Material point properties
x_p      = np.zeros(nparticles)       # positions
vol_p    = np.ones(nparticles)*dx/ppc # volume
mass_p   = vol_p * rho                # mass
stress_p = np.zeros(nparticles)       # stress
vel_p    = np.zeros(nparticles)       # velocity
vol0_p   = vol_p                      # initial volume
defg_p   = np.ones(nparticles)

# Generate particles
x_p, mpoints = generate_particles(ppc, elements, x_n)

for i in range(nparticles):
    # set initial velocities
    vel_p[i] = v0 * np.sin(b1 * x_p[i])

# Time steps and duration
duration = 100
dt_crit = dx / c
dt = 0.1 * dt_crit
t = 0
nsteps = int(duration / dt)

tt, vt, xt = [], [], []

for step in range(nsteps):
    # reset nodal values
    mass_n  = np.zeros(nnodes)  # mass
    mom_n   = np.zeros(nnodes)  # momentum
    fint_n = np.zeros(nnodes)  # internal force

    # iterate through each element
    for eid in range(nelements):
        # get nodal ids
        nid1, nid2 = elements[eid]
        # get particle ids associated with the element 
        mpts = mpoints[eid]
        # iterate through all particles in the element
        for pid in mpts:
            # compute shape functions and derivatives
            N1 = 1 - abs(x_p[pid] - x_n[nid1]) / dx
            N2 = 1 - abs(x_p[pid] - x_n[nid2]) / dx
            dN1 = -1/dx
            dN2 = 1/dx

            # map particle mass and momentum to nodes
            mass_n[nid1] += N1 * mass_p[pid]
            mass_n[nid2] += N2 * mass_p[pid]
            mom_n[nid1]  += N1 * mass_p[pid] * vel_p[pid]
            mom_n[nid2]  += N2 * mass_p[pid] * vel_p[pid]

            # compute nodal internal force
            fint_n[nid1] -= vol_p[pid] * stress_p[pid] * dN1
            fint_n[nid2] -= vol_p[pid] * stress_p[pid] * dN2

    # apply boundary conditions
    mom_n[0]  = 0  # Nodal velocity v = 0 in m * v at node 0.
    fint_n[0] = 0  # Nodal force f = m * a, where a = 0 at node 0.

    # update nodal momentum
    for nid in range(nnodes):
        mom_n[nid] += fint_n[nid] * dt

    # update particle velocity position and stress
    # iterate through each element
    for eid in range(nelements):
        # get nodal ids
        nid1, nid2 = elements[eid]
        # get particle ids associated with the element 
        mpts = mpoints[eid]
        # iterate through all particles in the element
        for pid in mpts:
            # compute shape functions and derivatives
            N1 = 1 - abs(x_p[pid] - x_n[nid1]) / dx
            N2 = 1 - abs(x_p[pid] - x_n[nid2]) / dx
            dN1 = -1/dx
            dN2 = 1/dx

            # compute particle velocity
            if (mass_n[nid1]) &gt; tol:
                vel_p[pid] += dt * N1 * fint_n[nid1] / mass_n[nid1]
            if (mass_n[nid2]) &gt; tol:
                vel_p[pid] += dt * N2 * fint_n[nid2] / mass_n[nid2]
            
            # update particle position based on nodal momentum
            x_p[pid] += dt * (N1 * mom_n[nid1]/mass_n[nid1] + N2 * mom_n[nid2]/mass_n[nid2])

            # nodal velocity
            nv1 = mom_n[nid1]/mass_n[nid1]
            nv2 = mom_n[nid2]/mass_n[nid2]

            # Apply boundary condition
            # Rendundant, since momentum and forces are already set to zero
            # if (nid1 == 0): nv1 = 0

            # rate of strain increment
            grad_v = dN1 * nv1 + dN2 * nv2
            # particle dstrain
            dstrain = grad_v * dt
            # particle volume
            vol_p[pid] *= (1 + dstrain)        
            # update stress using linear elastic model
            stress_p[pid] += E * dstrain

    # update plot params
    tt.append(t)
    vt.append(vel_p[pmid])
    xt.append(x_p[pmid])

    t = t + dt
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>Plot velocity at the center of the bar</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.plot(ta, va, &#39;r&#39;, linewidth=1,label=&#39;analytical&#39;)
plt.plot(tt, vt, &#39;ob&#39;, markersize=1, label=&#39;mpm&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;velocity (m/s)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_26_0.png" src="_images/axial-vibration1d_26_0.png" />
</div>
</div>
<blockquote>
<div><p>Plot displacement at the center of the bar</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.plot(ta, xa, &#39;r&#39;, linewidth=1,label=&#39;analytical&#39;)
plt.plot(tt, xt-xt[0], &#39;ob&#39;, markersize=1, label=&#39;mpm&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;displacement (m)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/axial-vibration1d_28_0.png" src="_images/axial-vibration1d_28_0.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="point-axial-vibration1d.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">1D vibration of a single material point</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="mpm-code.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Coding 1D MPM</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Krishna Kumar<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>