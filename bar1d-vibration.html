
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Solving 1D vibrating bar with Material Point Method &#8212; Learn MPM</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MPM1D Code" href="mpm-code.html" />
    <link rel="prev" title="Welcome to learn MPM with Python" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Learn MPM</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to learn MPM with Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Solving 1D vibrating bar with Material Point Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mpm-code.html">
   MPM1D Code
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/geoelements/learn-mpm/main?urlpath=lab/tree/docs/bar1d-vibration.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/geoelements/learn-mpm/blob/main/docs/bar1d-vibration.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/geoelements/learn-mpm"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/geoelements/learn-mpm/issues/new?title=Issue%20on%20page%20%2Fbar1d-vibration.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/bar1d-vibration.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analytical-solution">
   Analytical solution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-mpm-code-usl-scheme">
   1D MPM code - USL Scheme
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialization-phase">
     1. Initialization phase
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#computational-domain">
       Computational domain
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#material-properties">
       Material properties
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#initial-loading-conditions">
       Initial loading conditions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#material-points">
       Material points
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shape-functions">
       Shape functions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#shape-function-for-material-point">
         Shape function for material point
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-phase-for-time-step-t-to-t-delta-t">
     2. Solution phase for time step
     <span class="math notranslate nohighlight">
      \(t\)
     </span>
     to
     <span class="math notranslate nohighlight">
      \(t + \Delta t\)
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#map-mass-and-momentum-to-nodes">
       Map mass and momentum to nodes
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#applying-boundary-condition">
       Applying boundary condition
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-nodal-forces">
     Compute nodal forces
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-external-forces">
       Compute external forces
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-internal-forces">
       Compute internal forces
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculate-the-total-unbalanced-nodal-forces">
       Calculate the total unbalanced nodal forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-nodal-momentum">
     Update nodal momentum
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#critical-time-step">
       Critical time step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mapping-from-nodes-to-particles">
     Mapping from nodes to particles
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-particle-velocities-and-position">
       Update particle velocities and position
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-particle-momentum">
       Update particle momentum
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-nodal-velocity">
       Update nodal velocity
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-strains-and-stresses">
       Compute strains and stresses
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#d-mpm-code-complete">
     1D MPM code complete
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-results-of-mpm-and-analytical-solution">
       Plot results of MPM and analytical solution
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Solving 1D vibrating bar with Material Point Method</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analytical-solution">
   Analytical solution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-mpm-code-usl-scheme">
   1D MPM code - USL Scheme
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialization-phase">
     1. Initialization phase
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#computational-domain">
       Computational domain
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#material-properties">
       Material properties
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#initial-loading-conditions">
       Initial loading conditions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#material-points">
       Material points
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shape-functions">
       Shape functions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#shape-function-for-material-point">
         Shape function for material point
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-phase-for-time-step-t-to-t-delta-t">
     2. Solution phase for time step
     <span class="math notranslate nohighlight">
      \(t\)
     </span>
     to
     <span class="math notranslate nohighlight">
      \(t + \Delta t\)
     </span>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#map-mass-and-momentum-to-nodes">
       Map mass and momentum to nodes
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#applying-boundary-condition">
       Applying boundary condition
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-nodal-forces">
     Compute nodal forces
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-external-forces">
       Compute external forces
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-internal-forces">
       Compute internal forces
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculate-the-total-unbalanced-nodal-forces">
       Calculate the total unbalanced nodal forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-nodal-momentum">
     Update nodal momentum
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#critical-time-step">
       Critical time step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mapping-from-nodes-to-particles">
     Mapping from nodes to particles
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-particle-velocities-and-position">
       Update particle velocities and position
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-particle-momentum">
       Update particle momentum
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#update-nodal-velocity">
       Update nodal velocity
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-strains-and-stresses">
       Compute strains and stresses
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#d-mpm-code-complete">
     1D MPM code complete
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-results-of-mpm-and-analytical-solution">
       Plot results of MPM and analytical solution
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="solving-1d-vibrating-bar-with-material-point-method">
<h1>Solving 1D vibrating bar with Material Point Method<a class="headerlink" href="#solving-1d-vibrating-bar-with-material-point-method" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/geoelements/learn-mpm/blob/main/bar1d-vibration.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>Let us consider the vibration of a single material point as shown below. The bar is represented by a single point initially located at <span class="math notranslate nohighlight">\(x_p = L/2\)</span>, which has an initial velocity <span class="math notranslate nohighlight">\(v_0\)</span>. The material is linear elastic.</p>
<p><img alt="bar1d" src="_images/bar1d.png" /></p>
<p>The exact solution for the velocity is: <span class="math notranslate nohighlight">\(v(t) = v_0 \cos (\omega t), \quad \omega = \frac{1}{L}\sqrt{E/\rho}\)</span></p>
<p>and for the position is: <span class="math notranslate nohighlight">\(x(t) = x_0 \exp \left[\frac{v_0}{L \omega} \sin (\omega t)\right]\)</span></p>
<p>The bar has a constant density <span class="math notranslate nohighlight">\(\rho = 1.0\)</span>. The constitutive equation is <span class="math notranslate nohighlight">\(\dot\sigma = E \dot \varepsilon\)</span>, where <span class="math notranslate nohighlight">\(\dot \varepsilon = dv/dx\)</span> and <span class="math notranslate nohighlight">\(E\)</span> is the Young’s modulus. The mesh consists of a single two-noded element. The elastic wave speed is <span class="math notranslate nohighlight">\(c = \sqrt{E/\rho} = 2 \pi\)</span>. The boundary conditions are imposed on the mesh, both the nodal velocity and the acceleration at <span class="math notranslate nohighlight">\(x = 0\)</span> (the left node) is zero throughout the simulation.</p>
<section id="analytical-solution">
<h2>Analytical solution<a class="headerlink" href="#analytical-solution" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np

# Analytical solution
def analytical_vibration(E, rho, v0, x_loc, duration, dt, L):
    nsteps = int(duration/dt)
    tt, vt, xt = [], [], []
    t = 0
    for _ in range(nsteps):
        omega = 1. / L * np.sqrt(E / rho)
        v = v0 * np.cos(omega * t)
        x = x_loc * np.exp(v0 / (L * omega) * np.sin(omega * t))
        vt.append(v)
        xt.append(x)
        tt.append(t)
        t += dt
    return tt, vt, xt
</pre></div>
</div>
</div>
</div>
<p>Let’s now plot the analytical solution of a vibrating bar at the end of the bar <span class="math notranslate nohighlight">\(x = 1\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt

# Young&#39;s modulus
E = 4 * (np.pi)**2

# analytical solution at the end of the bar
ta, va, xa = analytical_vibration(E = E, rho = 1, v0 = 0.1, x_loc = 1.0, duration = 10, dt = 0.01, L = 1.0)

plt.plot(ta, va, &#39;r&#39;,linewidth=2,label=&#39;analytical&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;velocity (m/s)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bar1d-vibration_4_0.png" src="_images/bar1d-vibration_4_0.png" />
</div>
</div>
</section>
<section id="d-mpm-code-usl-scheme">
<h2>1D MPM code - USL Scheme<a class="headerlink" href="#d-mpm-code-usl-scheme" title="Permalink to this headline">#</a></h2>
<p>We will use the Update Stress Last (USL) algorithm to implement the 1D vibrating bar example. An overview of the USL MPM algorithm is shown below:</p>
<ol>
<li><p>Initialisation phase</p>
<p>(a) Particle distribution in the undeformed configuration</p>
<p>(b) Grid set up</p>
<p>(c) Initialise particle quantities such as mass, stress, strain, etc.</p>
</li>
<li><p>Solution phase for time step <span class="math notranslate nohighlight">\(t\)</span> to <span class="math notranslate nohighlight">\(t + \Delta t\)</span></p>
<p>(a) Mapping from particles to nodes</p>
<p>i. Compute nodal mass: <span class="math notranslate nohighlight">\(m_i^t = \sum\limits_{p=1}^{n_P} N_i(\textbf{x}_p^t) m_p\)</span></p>
<p>ii. Compute nodal momentum: <span class="math notranslate nohighlight">\((m \textbf{v})_i^{t} = \sum\limits_{p=1}^{n_P} N_i(\textbf{x}_p^t) m_p \textbf{v}_p^{t}\)</span></p>
<p>iii. Compute external force: <span class="math notranslate nohighlight">\( (\textbf{f}_i)^{ext,t} = \textbf{b}_i^{t} + \textbf{t}_i^{t} \)</span></p>
<p>iv. Compute internal force <span class="math notranslate nohighlight">\( (\textbf{f}_i)^{int,t} = \sum\limits_{p=1}^{n_P} V_p^t B_i(\textbf{x}_p^t) \boldsymbol{\sigma}_p^{t} \)</span></p>
<p>v. Compute nodal force: <span class="math notranslate nohighlight">\( (\textbf{f}_i)^{tot,t} = (\textbf{f}_i)^{ext,t} + (\textbf{f}_i)^{int,t}\)</span></p>
<p>(b) Update momenta: <span class="math notranslate nohighlight">\((m \textbf{v})_i^{t + \Delta t} = (m \textbf{v})_i^{t} +  \textbf{f}_i^{tot,t} * \Delta t\)</span></p>
<p>(c) Mapping from nodes to particles</p>
<p>i. Update material point velocity: <span class="math notranslate nohighlight">\( \textbf{v}_p^{t+\Delta t} = \sum\limits_{i=1}^{n_n} N_i(\textbf{x}_p^t) \textbf{v}_i^{t+\Delta t} \)</span></p>
<p>ii. Update material point position: <span class="math notranslate nohighlight">\( \textbf{x}_p^{t+\Delta t} = \textbf{x}_p^t + \textbf{v}_p^{t+\Delta t} *  \Delta t\)</span></p>
<p>iii. Update nodal velocities: <span class="math notranslate nohighlight">\(\textbf{v}_i^{t + \Delta t} = (m \textbf{v})_i^{t + \Delta t} / m_i^{t}\)</span></p>
<p>iv. Calculate strain rate: <span class="math notranslate nohighlight">\( \boldsymbol{\varepsilon}_p^t = \sum\limits_{p=1}^{n_P} B_i(\textbf{x}_p^t) \textbf{v}_i^t \)</span></p>
<p>v. Compute incremental stress based on a constitutive model <span class="math notranslate nohighlight">\( \Delta\boldsymbol{\sigma}_p^t= \mathbf{D} : \Delta \boldsymbol{\varepsilon}_p^t \)</span>.</p>
<p>vi. Compute updated stress at each material point: <span class="math notranslate nohighlight">\( \boldsymbol{\sigma}_p^t = \boldsymbol{\sigma}_p^{t-\Delta t} + \Delta \boldsymbol{\sigma}_p^t \)</span></p>
</li>
<li><p>Reset the grid and advance to the next step</p></li>
</ol>
<section id="initialization-phase">
<h3>1. Initialization phase<a class="headerlink" href="#initialization-phase" title="Permalink to this headline">#</a></h3>
<section id="computational-domain">
<h4>Computational domain<a class="headerlink" href="#computational-domain" title="Permalink to this headline">#</a></h4>
<p>Let’s now develop a 1D MPM code for bar vibration with a single material point in the middle of the element.</p>
<p><img alt="1d bar" src="_images/bar1dmpm.png" /></p>
<p>The domain (bar) has a length of 1 m. We descritize the bar using a single linear element with two nodes. The left node is at 0 and the right node is at the end of the bar at L.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
# Computational grid
L          = 1                       # domain size
nodes      = np.array([0, L])        # nodal coordinates
nnodes     = len(nodes)              # number of nodes
nelements  = 1                       # number of elements
nparticles = 1                       # number of particles
el_length  = L / nelements           # element length

print(&quot;Number of elements: {} nodal coordinates: {}, nnodes: {} nparticles: {}&quot;.
        format(nelements, nodes, nnodes, nparticles))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of elements: 1 nodal coordinates: [0 1], nnodes: 2 nparticles: 1
</pre></div>
</div>
</div>
</div>
</section>
<section id="material-properties">
<h4>Material properties<a class="headerlink" href="#material-properties" title="Permalink to this headline">#</a></h4>
<p>We now define a linear elastic material with <span class="math notranslate nohighlight">\(E = 2 * \pi^2\)</span> and a density <span class="math notranslate nohighlight">\(\rho = 1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Material property
E          = 4 * (np.pi)**2          # Young&#39;s modulus
rho        = 1.                      # Density
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-loading-conditions">
<h4>Initial loading conditions<a class="headerlink" href="#initial-loading-conditions" title="Permalink to this headline">#</a></h4>
<p>We apply an initial velocity <span class="math notranslate nohighlight">\(v_0 = 0.1\)</span> at the material point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Initial conditions 
v0         = 0.1                     # initial velocity
x_loc      = 0.5                     # location to get analytical solution
</pre></div>
</div>
</div>
</div>
</section>
<section id="material-points">
<h4>Material points<a class="headerlink" href="#material-points" title="Permalink to this headline">#</a></h4>
<p>In MPM, the material points keep track of the position, mass, velocity, volume, momentum and stress. The material point is at the middle of the element. The volume of the material point is the size of the entire length of the bar. Assuming a density <span class="math notranslate nohighlight">\(\rho = 1\)</span>, the mass of the material point is <span class="math notranslate nohighlight">\(\rho * L = 1 * 1 = 1.0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Material points
x_p        = 0.5 * el_length         # particle position
mass_p     = 1.                      # particle mass
vol_p      = el_length / nparticles  # particle volume
vel_p      = v0                      # particle velocity
stress_p   = 0.                      # particle stress
mv_p       = mass_p * vel_p          # particle momentum = m * v
</pre></div>
</div>
</div>
</div>
</section>
<section id="shape-functions">
<h4>Shape functions<a class="headerlink" href="#shape-functions" title="Permalink to this headline">#</a></h4>
<p>We will use a two-noded single element with linear elements. In order to avoid finding the natural coordinates of material points, we define the shape functions in the global coordinate system. In 1D, the shape functions are defined as:</p>
<p><span class="math notranslate nohighlight">\(N_i (x) = \begin{cases} 1 - |x - x_i|/l &amp; \text{if } | x - x_i| \le l \\ 0 &amp; \text{else}  \end{cases}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(l\)</span> denotes the element size.</p>
<p>The following listings show the general shape functions and gradients for an element.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt

nodes = np.array([0, L])
xs = np.arange(0, L+0.1, 0.1)
y = np.zeros_like(xs)

# shape function
n1 = [1 - abs(x - nodes[0])/L for x in xs]
n2 = [1 - abs(x - nodes[1])/L for x in xs]

plt.plot(xs, n1, &#39;r&#39;, linewidth=2, label=&#39;N1&#39;)
plt.plot(xs, n2, &#39;b&#39;, linewidth=2, label=&#39;N2&#39;)
plt.plot(xs, y, &#39;-.&#39;, linewidth=2, label=&#39;element&#39;)
plt.xlabel(&#39;l&#39;)
plt.ylabel(&#39;N(x)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bar1d-vibration_15_0.png" src="_images/bar1d-vibration_15_0.png" />
</div>
</div>
<p>The derivative of the shape function is:</p>
<p><span class="math notranslate nohighlight">\(B (x) = [-1/l_x, 1/l_x]\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt

nodes = np.array([0, L])
xs = np.arange(0, L+0.1, 0.1)
y = np.zeros_like(xs)

# shape function
b1 = [-1/L for x_p in xs]
b2 = [1/L for x_p in xs]

plt.plot(xs, b1, &#39;r&#39;, linewidth=2, label=&#39;B1&#39;)
plt.plot(xs, b2, &#39;b&#39;, linewidth=2, label=&#39;B2&#39;)
plt.plot(xs, y, &#39;-.&#39;, linewidth=2, label=&#39;element&#39;)
plt.xlabel(&#39;l&#39;)
plt.ylabel(&#39;B(x)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bar1d-vibration_17_0.png" src="_images/bar1d-vibration_17_0.png" />
</div>
</div>
<section id="shape-function-for-material-point">
<h5>Shape function for material point<a class="headerlink" href="#shape-function-for-material-point" title="Permalink to this headline">#</a></h5>
<p>We will now define the shape function and its derivatives for the material point located at <span class="math notranslate nohighlight">\(x_p\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># shape function and derivative
N     = np.array([1 - abs(x_p - nodes[0])/L, 1 - abs(x_p - nodes[1])/L])
dN    = np.array([-1/L, 1/L])

print(&quot;Shape function for material point at x_p = 0.5, is N: {}&quot;.format(N))
print(&quot;Gradient of shape function for material point at x_p = 0.5, is B: {}&quot;.format(dN))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape function for material point at x_p = 0.5, is N: [0.5 0.5]
Gradient of shape function for material point at x_p = 0.5, is B: [-1.  1.]
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="solution-phase-for-time-step-t-to-t-delta-t">
<h3>2. Solution phase for time step <span class="math notranslate nohighlight">\(t\)</span> to <span class="math notranslate nohighlight">\(t + \Delta t\)</span><a class="headerlink" href="#solution-phase-for-time-step-t-to-t-delta-t" title="Permalink to this headline">#</a></h3>
<section id="map-mass-and-momentum-to-nodes">
<h4>Map mass and momentum to nodes<a class="headerlink" href="#map-mass-and-momentum-to-nodes" title="Permalink to this headline">#</a></h4>
<p>Mapping from particles to nodes. Let’s compute the nodal mass and momentum using the linear shape functions to map  mass and velocity of the material point.</p>
<p>Compute nodal mass: <span class="math notranslate nohighlight">\(m_i^t = \sum\limits_{p=1}^{n_P} N_i(\textbf{x}_p^t) m_p\)</span></p>
<p>Compute nodal momentum: <span class="math notranslate nohighlight">\((m \textbf{v})_i^{t} = \sum\limits_{p=1}^{n_P} N_i(\textbf{x}_p^t) m_p \textbf{v}_p^{t}\)</span></p>
<p>where,</p>
<p><span class="math notranslate nohighlight">\(m_p^t\)</span> mass of the material point <span class="math notranslate nohighlight">\(p\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(m\textbf{v}_p^t\)</span> momentum of the material point <span class="math notranslate nohighlight">\(p\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(n_p\)</span> total number of material points in the body</p>
<p><span class="math notranslate nohighlight">\(m_i^t\)</span> mass of node <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(m\textbf{v}_i^t\)</span> momentum of node <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(N_i (\textbf{x}_p^t)\)</span> shape function that maps node <span class="math notranslate nohighlight">\(i\)</span> to material point <span class="math notranslate nohighlight">\(p\)</span> and vice versa with independent
variable of the location of each material point at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(B_i (\textbf{x}_p^t)\)</span> gradient of the shape function that maps node <span class="math notranslate nohighlight">\(i\)</span> to material point <span class="math notranslate nohighlight">\(p\)</span> and vice versa such that <span class="math notranslate nohighlight">\(B = \frac{dN}{d\textbf{x}}\)</span>.</p>
<hr class="docutils" />
<p>Here, we map the mass of the particle <code class="docutils literal notranslate"><span class="pre">mass_p</span></code> and its momentum <code class="docutils literal notranslate"><span class="pre">mv_p</span></code> to both the nodes 0 and 1 of the element. The code below is equivalent to doing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mass_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">mass_p</span>
<span class="n">mass_node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">mass_p</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># map particle mass and momentum to nodes
mass_n = N * mass_p
mv_n   = N * mv_p
</pre></div>
</div>
</div>
</div>
<p>The mass of the particle 1.0, is split equally between both the nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&quot;Mapped mass at the nodes: {}&quot;.format(mass_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mapped mass at the nodes: [0.5 0.5]
</pre></div>
</div>
</div>
</div>
<p>Similarly, the momentum of the particle, calculated as <span class="math notranslate nohighlight">\(m_p * v_p\)</span> is split evenly between the nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&quot;Momentum at nodes: {}&quot;.format(mv_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Momentum at nodes: [0.05 0.05]
</pre></div>
</div>
</div>
</div>
</section>
<section id="applying-boundary-condition">
<h4>Applying boundary condition<a class="headerlink" href="#applying-boundary-condition" title="Permalink to this headline">#</a></h4>
<p>Since the left node is fixed, we constrain the velocity at the node <span class="math notranslate nohighlight">\(v_n = 0\)</span> for node 0. As we store momentum, rather than the velocity at the node, we constrain the momentum on the left node to be zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># apply boundary condition: velocity at left node is zero
mv_n[0] = 0

print(&quot;Momentum at nodes after apply BCs: {}&quot;.format(mv_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Momentum at nodes after apply BCs: [0.   0.05]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="compute-nodal-forces">
<h3>Compute nodal forces<a class="headerlink" href="#compute-nodal-forces" title="Permalink to this headline">#</a></h3>
<section id="compute-external-forces">
<h4>Compute external forces<a class="headerlink" href="#compute-external-forces" title="Permalink to this headline">#</a></h4>
<p><span class="math notranslate nohighlight">\( (\textbf{f}_i)^{ext,t} = \textbf{b}_i^{t} + \textbf{t}_i^{t} \)</span></p>
<p>where,</p>
<p><span class="math notranslate nohighlight">\(\textbf{f}_i^{ext,t}\)</span> nodal external force of node <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(\textbf{b}_i^t\)</span> body force of node <span class="math notranslate nohighlight">\(i\)</span></p>
<p><span class="math notranslate nohighlight">\(\textbf{f}_i^t\)</span> nodal force of node <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p>In this problem, there is no external force, so we set the external forces at both nodes to be zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># external force at nodes
f_ext_n = np.array([0, 0])

print(&quot;External forces at the nodes: {}&quot;.format(f_ext_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>External forces at the nodes: [0 0]
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-internal-forces">
<h4>Compute internal forces<a class="headerlink" href="#compute-internal-forces" title="Permalink to this headline">#</a></h4>
<p>The internal force at the nodes is mapped from the particle stress:</p>
<p><span class="math notranslate nohighlight">\( (\textbf{f}_i)^{int,t} = \sum\limits_{p=1}^{n_P} V_p^t B_i(\textbf{x}_p^t) \boldsymbol{\sigma}_p^{t} \)</span></p>
<p>where,</p>
<p><span class="math notranslate nohighlight">\(\textbf{f}_i^{int,t}\)</span> nodal internal force of node <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(V_p\)</span> volume at material points <span class="math notranslate nohighlight">\(p\)</span></p>
<p><span class="math notranslate nohighlight">\(B_i (\textbf{x}_p^t)\)</span> gradient of the shape function that maps node <span class="math notranslate nohighlight">\(i\)</span> to material point <span class="math notranslate nohighlight">\(p\)</span> and vice versa such that <span class="math notranslate nohighlight">\(B = \frac{dN}{d\textbf{x}}\)</span></p>
<p><span class="math notranslate nohighlight">\(\boldsymbol{\sigma}_p^t\)</span> stress of material point <span class="math notranslate nohighlight">\(p\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p>
<hr class="docutils" />
<p>At the start of the time step, <span class="math notranslate nohighlight">\(t = 0\)</span>, the body is unstressed <span class="math notranslate nohighlight">\(\sigma = 0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># compute internal force at nodes
f_int_n = - dN * vol_p * stress_p 

print(&quot;Internal forces at the nodes: {}&quot;.format(f_ext_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Internal forces at the nodes: [0 0]
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-the-total-unbalanced-nodal-forces">
<h4>Calculate the total unbalanced nodal forces<a class="headerlink" href="#calculate-the-total-unbalanced-nodal-forces" title="Permalink to this headline">#</a></h4>
<p>The total unbalanced force at the node: <span class="math notranslate nohighlight">\( \textbf{f}_i^{tot,t} = \textbf{f}_i^{int,t} + \textbf{f}_i^{ext,t}\)</span></p>
<hr class="docutils" />
<p>For this problem, the external force is zero, so the total force must equal the internal force.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># total forces at nodes
f_total_n = f_int_n + f_ext_n

print(&quot;Total forces at the nodes: {}&quot;.format(f_total_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total forces at the nodes: [0. 0.]
</pre></div>
</div>
</div>
</div>
<p>We apply boundary condition on the left node, which is fixed (the velocity and acceleration are zero). Hence, we set the total force <span class="math notranslate nohighlight">\(f = m * a = 0\)</span>, since <span class="math notranslate nohighlight">\(a = 0\)</span> at the node.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># apply boundary condition: left node has no acceleration (f = m * a, and a = 0)
f_total_n[0] = 0

print(&quot;Total forces at the nodes: {}&quot;.format(f_total_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total forces at the nodes: [0. 0.]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="update-nodal-momentum">
<h3>Update nodal momentum<a class="headerlink" href="#update-nodal-momentum" title="Permalink to this headline">#</a></h3>
<p>Nodal momentum: <span class="math notranslate nohighlight">\( (m\textbf{v})_i^{t+\Delta t} = (m\textbf{v})_i^t + \textbf{f}_i^{tot,t} * \Delta t\)</span></p>
<section id="critical-time-step">
<h4>Critical time step<a class="headerlink" href="#critical-time-step" title="Permalink to this headline">#</a></h4>
<p>The time step <span class="math notranslate nohighlight">\(\Delta t\)</span> must be smaller than the critical time step <span class="math notranslate nohighlight">\(\Delta t_{crit}\)</span>. Typically, <span class="math notranslate nohighlight">\(\Delta t = \Delta t_{crit}/10\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\Delta t_{crit} = \frac{L}{\sqrt{E \cdot \rho}}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># critical time step
dt_crit = L /np.sqrt(E/rho)
print(&quot;Critical time step for an explicit simulation: {}&quot;.format(dt_crit))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Critical time step for an explicit simulation: 0.15915494309189535
</pre></div>
</div>
</div>
</div>
<p>We use a time step <span class="math notranslate nohighlight">\(\Delta t\)</span> of 0.01.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># update nodal momentum
dt = 0.01 
mv_n += f_total_n * dt

print(&quot;Momentum at nodes: {}&quot;.format(mv_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Momentum at nodes: [0.   0.05]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="mapping-from-nodes-to-particles">
<h3>Mapping from nodes to particles<a class="headerlink" href="#mapping-from-nodes-to-particles" title="Permalink to this headline">#</a></h3>
<section id="update-particle-velocities-and-position">
<h4>Update particle velocities and position<a class="headerlink" href="#update-particle-velocities-and-position" title="Permalink to this headline">#</a></h4>
<p>Update the position of the material points based on the nodal velocity.</p>
<ul class="simple">
<li><p>Material point velocity:
<span class="math notranslate nohighlight">\( \textbf{v}_p^{t+\Delta t} = \sum\limits_{i=1}^{n_n} N_i(\textbf{x}_p^t) \textbf{v}_i^{t+\Delta t} \)</span></p></li>
<li><p>Material point position:
<span class="math notranslate nohighlight">\( \textbf{x}_p^{t+\Delta t} = \textbf{x}_p^t + \textbf{v}_p^{t+\Delta t} *  \Delta t\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># update particle position and velocity
for i in range(nnodes):
    vel_p += dt * N[i] * f_total_n[i] / mass_n[i]
    x_p += dt * N[i] * mv_n[i] / mass_n[i]

print(&quot;Velocity of particle: {} and position: {}&quot;.format(vel_p, x_p))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Velocity of particle: 0.1 and position: 0.5005
</pre></div>
</div>
</div>
</div>
</section>
<section id="update-particle-momentum">
<h4>Update particle momentum<a class="headerlink" href="#update-particle-momentum" title="Permalink to this headline">#</a></h4>
<p>Material point momentum: <span class="math notranslate nohighlight">\( (m\textbf{v})_p^{t+\Delta t} = m_p * \textbf{v}_p^{t+\Delta t}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># update particle momentum
mv_p = mass_p * vel_p
</pre></div>
</div>
</div>
</div>
</section>
<section id="update-nodal-velocity">
<h4>Update nodal velocity<a class="headerlink" href="#update-nodal-velocity" title="Permalink to this headline">#</a></h4>
<p>The typical equation to update nodal velocity is based on the nodal momentum: <span class="math notranslate nohighlight">\(\textbf{v}_i^{t + \Delta t} = (m \textbf{v})_i^{t + \Delta t} / m_i^{t}\)</span>.</p>
<p>However, we prefer to remap the particle velocity and mass and use the interpolated nodal mass to compute the nodal velocities: <span class="math notranslate nohighlight">\((\textbf{v})_i^{t + \Delta t} = \sum\limits_{p=1}^{n_P} N_i(\textbf{x}_p^{t}) m_p \textbf{v}_p^{t + \Delta t} / m_i^{t + \Delta t}\)</span></p>
<p>After updating the nodal velocity, re-constrain the velocity at the fixed node back to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># map nodal velocity
# vel_n[0] = N[0] * mass_p * vel_p / mass_n[0]
# vel_n[1] = N[1] * mass_p * vel_p / mass_n[1]
vel_n = np.divide(N, mass_n) * mass_p * vel_p

# Apply boundary condition and set left nodal velocity to zero
vel_n[0] = 0

print(&quot;Velocity at the nodes: {}&quot;.format(vel_n))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Velocity at the nodes: [0.  0.1]
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-strains-and-stresses">
<h4>Compute strains and stresses<a class="headerlink" href="#compute-strains-and-stresses" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>The strain at each material point is computed by mapping the strain rate from the nodes: <span class="math notranslate nohighlight">\( \boldsymbol{\varepsilon}_p^t = \sum\limits_{p=1}^{n_P} B_i(\textbf{x}_p^t) \textbf{v}_i^t \)</span></p></li>
<li><p>The stress at each material point is updated using <span class="math notranslate nohighlight">\(\Delta\sigma_p^t\)</span> based on the constitutive model:
<span class="math notranslate nohighlight">\( \boldsymbol{\sigma}_p^t = \boldsymbol{\sigma}_p^{t-\Delta t} + \Delta \boldsymbol{\sigma}_p^t \)</span></p></li>
<li><p>The incremental stress is calculated as <span class="math notranslate nohighlight">\( \Delta\boldsymbol{\sigma}_p^t= \mathbf{D} : \Delta \boldsymbol{\varepsilon}_p^t \)</span>. In this case, we use a linear elastic model with a Young’s modulus of <span class="math notranslate nohighlight">\(E\)</span>, so the stress increment <span class="math notranslate nohighlight">\( \Delta\boldsymbol{\sigma}_p^t= E \cdot \Delta \boldsymbol{\varepsilon}_p^t \)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># compute strain rate at the particle
# strain_rate = dN[0] * vel_n[0] + dN[1] * vel_n[1]
strain_rate_p = np.dot(dN, vel_n) 
# compute strain increament 
dstrain_p = strain_rate_p * dt
# compute stress
stress_p += E * dstrain_p

print(&quot;Strain rate: {}, dstrain: {} and stress: {} and stress: {}&quot;.format(strain_rate_p, dstrain_p, E * dstrain_p, stress_p))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Strain rate: 0.1, dstrain: 0.001 and stress: 0.039478417604357434 and stress: 0.039478417604357434
</pre></div>
</div>
</div>
</div>
<p>This completes all the steps in the MPM USL algorithm. These steps are repeated <code class="docutils literal notranslate"><span class="pre">n</span></code> times as shown in the full code below.</p>
</section>
</section>
<section id="d-mpm-code-complete">
<h3>1D MPM code complete<a class="headerlink" href="#d-mpm-code-complete" title="Permalink to this headline">#</a></h3>
<p>Putting it all together</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Computational grid
L          = 1                       # domain size
nodes      = np.array([0, L])        # nodal coordinates
nnodes     = len(nodes)              # number of nodes
nelements  = 1                       # number of elements
nparticles = 1                       # number of particles
el_length  = L / nelements           # element length

# Initial conditions 
v0         = 0.1                     # initial velocity
x_loc      = 0.5                     # location to get analytical solution

# Material property
E          = 4 * (np.pi)**2          # Young&#39;s modulus
rho        = 1.                      # Density

# Material points
x_p        = 0.5 * el_length         # particle position
mass_p     = 1.                      # particle mass
vol_p      = el_length / nparticles  # particle volume
vel_p      = v0                      # particle velocity
stress_p   = 0.                      # particle stress
mv_p       = mass_p * vel_p          # particle momentum = m * v

# Time
duration   = 10
dt         = 0.01
time       = 0
nsteps     = int(duration/dt)

# Store time, velocity and position with time
time_t, vel_t, x_t = [], [], []

for _ in range(nsteps):
    # shape function and derivative
    N  = np.array([1 - abs(x_p - nodes[0])/L, 1 - abs(x_p - nodes[1])/L])
    dN = np.array([-1/L, 1/L])

    # map particle mass and momentum to nodes
    mass_n = N * mass_p
    mv_n   = N * mv_p
    
    # apply boundary condition: velocity at left node is zero
    mv_n[0] = 0

    # external force at nodes
    f_ext_n = np.array([0, 0])

    # compute internal force at nodes
    f_int_n = - dN * vol_p * stress_p 

    # total forces at nodes
    f_total_n = f_int_n + f_ext_n

    # apply boundary condition: left node has no acceleration (f = m * a, and a = 0)
    f_total_n[0] = 0

    # update nodal momentum
    mv_n += f_total_n * dt

    # update particle position and velocity
    for i in range(nnodes):
        vel_p += dt * N[i] * f_total_n[i] / mass_n[i]
        x_p += dt * N[i] * mv_n[i] / mass_n[i]

    # update particle momentum
    mv_p = mass_p * vel_p

    # map nodal velocity
    vel_n = mass_p * vel_p * np.divide(N, mass_n)
    # Apply boundary condition and set left nodal velocity to zero
    vel_n[0] = 0

    # compute strain rate at the particle
    strain_rate_p = np.dot(dN, vel_n) 
    # compute strain increament 
    dstrain_p = strain_rate_p * dt
    # compute stress
    stress_p += E * dstrain_p

    # store properties for plotting
    time_t.append(time)
    vel_t.append(vel_p)
    x_t.append(x_p)
    
    # update time
    time += dt
</pre></div>
</div>
</div>
</div>
<section id="plot-results-of-mpm-and-analytical-solution">
<h4>Plot results of MPM and analytical solution<a class="headerlink" href="#plot-results-of-mpm-and-analytical-solution" title="Permalink to this headline">#</a></h4>
<p>Compare the MPM results with the analytical solution.</p>
<blockquote>
<div><p>Velocity</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt

ta, va, xa = analytical_vibration(E, rho, v0, x_loc, duration, dt, L)

plt.plot(ta, va, &#39;r&#39;, linewidth=2,label=&#39;analytical&#39;)
plt.plot(time_t, vel_t, &#39;ob&#39;, markersize = 2, label=&#39;mpm&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;velocity (m/s)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bar1d-vibration_52_0.png" src="_images/bar1d-vibration_52_0.png" />
</div>
</div>
<blockquote>
<div><p>displacement</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.plot(ta, xa, &#39;r&#39;,linewidth=2,label=&#39;analytical&#39;)
plt.plot(time_t, x_t, &#39;ob&#39;, markersize = 2, label=&#39;mpm&#39;)

plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;displacement (m)&#39;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bar1d-vibration_54_0.png" src="_images/bar1d-vibration_54_0.png" />
</div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Welcome to learn MPM with Python</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="mpm-code.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">MPM1D Code</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Krishna Kumar<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>